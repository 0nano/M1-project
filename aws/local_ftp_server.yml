- name: Install dependencies for docker and docker-compose
  become: yes
  apt:
    update_cache: yes
    name: "{{ item }}"
    state: present
  with_items:
    - apt-transport-https
    - ca-certificates
    - curl
    - lsb-release
    - gnupg2
    - python3-pip

- name: Add Docker GPG key
  become: yes
  shell: 'curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg'

- name: Add the repository to fetch the docker package
  become: yes
  shell: 'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian bullseye stable" | tee /etc/apt/sources.list.d/docker.list'

- name: Update source list and then install docker
  become: yes
  apt:
    update_cache: yes
    name: docker-ce
    state: latest 

- name: Install the Docker module for Python, required by ansible
  apt:
    name: python3-docker
    state: present

- name: Install docker-compose
  apt:
    name: docker-compose
    state: present

- name: Pull ftp docker image 
  become: yes
  shell: 'sudo docker pull stilliard/pure-ftpd'

- name: Run FTP container
  become: yes
  shell: 'sudo docker run --rm -d --name ftpd_server -p 21:21 -p 30000-30009:30000-30009 stilliard/pure-ftpd bash /run.sh -c 30 -C 10 -l puredb:/etc/pure-ftpd/pureftpd.pdb -E -j -R -P localhost -p 30000:30059'